pool:
  name: Deployment-OnPrem-Production
#Your build pipeline references an undefined variable named ‘$folderPath’. Create or edit the build pipeline for this YAML file, define the variable on the Variables tab. See https://go.microsoft.com/fwlink/?linkid=865972
#Your build pipeline references an undefined variable named ‘$folderPath’. Create or edit the build pipeline for this YAML file, define the variable on the Variables tab. See https://go.microsoft.com/fwlink/?linkid=865972
#Your build pipeline references an undefined variable named ‘$folderPath’. Create or edit the build pipeline for this YAML file, define the variable on the Variables tab. See https://go.microsoft.com/fwlink/?linkid=865972
#Your build pipeline references the ‘BuildConfiguration’ variable, which you’ve selected to be settable at queue time. Create or edit the build pipeline for this YAML file, define the variable on the Variables tab, and then select the option to make it settable at queue time. See https://go.microsoft.com/fwlink/?linkid=865971

steps:
  - task: UseDotNet@2
    displayName: 'Use .NET Core sdk '
    inputs:
      version: 8.0.x

  - powershell: |
      # Define the directory path
      $folderPath = " /home/xnelsystems-production/services/streamFlow/*"
      
      # Check if the directory exists
      if(Test-Path $folderPath)
      {
          # Remove all files and subdirectories
          try
          {
              Remove-Item $folderPath -Recurse -Force -ErrorAction Stop
              Write-Host "Successfully cleaned up directory: $($folderPath)"
          }
          catch
          {
              Write-Warning "Failed to clean up directory: $($folderPath)"
          }
      }
      else
      {
          Write-Warning "Directory '$folderPath' does not exist."
      }
    displayName: 'PowerShell Script'

  - task: DotNetCoreCLI@2
    displayName: 'dotnet publish'
    inputs:
      command: publish
      publishWebProjects: false
      projects: src/Modules/XFramework.StreamFlow/StreamFlow.Stream/StreamFlow.Stream.csproj
      arguments: '--configuration $(BuildConfiguration) --output "/home/xnelsystems-production/services/streamFlow"'
      zipAfterPublish: false
      modifyOutputPath: false
